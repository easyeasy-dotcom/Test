<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visit Time Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* ===== YOUR ORIGINAL CSS (UNCHANGED) ===== */
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:'Segoe UI',Tahoma,Verdana;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh;
            padding:20px;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center
        }
        .nav-bar{position:fixed;top:20px;left:20px;z-index:1000}
        .nav-link{
            background:#fff;color:#667eea;
            padding:12px 24px;border-radius:25px;
            text-decoration:none;font-weight:600;
            margin-right:10px;cursor:pointer
        }
        .page{display:none}
        .page.active{display:block}
        .container{
            background:#fff;border-radius:20px;
            padding:40px;max-width:900px;width:100%
        }
        .chart-container{height:400px;margin-bottom:20px}
        button{
            background:linear-gradient(135deg,#667eea,#764ba2);
            color:#fff;border:none;
            padding:12px 30px;border-radius:25px;
            cursor:pointer
        }
        button.active{background:#764ba2}
        .period-selector{
            display:flex;gap:10px;
            justify-content:center;margin-bottom:20px
        }
    </style>
</head>

<body>

<div class="nav-bar">
    <a class="nav-link" onclick="showPage('main')">ðŸ“Š Main Dashboard</a>
    <a class="nav-link" onclick="showPage('more')">ðŸ“ˆ More Data</a>
</div>

<div id="mainPage" class="page active">
<div class="container">

<h1 style="text-align:center;margin-bottom:20px">ðŸ“Š Visit Tracker</h1>

<div class="period-selector">
    <button class="period-btn active" onclick="changePeriod(30,this)">Last 30 Days</button>
    <button class="period-btn" onclick="changePeriod(40,this)">Last 40 Days</button>
    <button class="period-btn" onclick="changePeriod(50,this)">Last 50 Days</button>
</div>

<div style="text-align:center;margin-bottom:15px">
    <label>Select Date:</label>
    <input type="date" id="dateFilter" onchange="filterByDate()">
    <button onclick="showAllDates()">Show All</button>
</div>

<div class="chart-container">
    <canvas id="visitChart"></canvas>
</div>

<div class="chart-container">
    <canvas id="activityChart"></canvas>
</div>

<div style="text-align:center">
    <button onclick="addTestData()">Add Test Data</button>
    <button onclick="clearData()">Clear Data</button>
</div>

</div>
</div>

<div id="morePage" class="page">
<div class="container">
    <h1>ðŸ“ˆ Detailed Statistics</h1>
    <p>Your original content remains unchanged.</p>
</div>
</div>

<script>
/* ===== FIXED JS (MINIMAL CHANGES ONLY) ===== */

let visits=[];
let visitChart=null;
let activityChart=null;
let currentPeriod=30;
let selectedDate=null;

/* --- STORAGE --- */
function loadVisits(){
    const stored=localStorage.getItem("visit-times");
    if(stored)visits=JSON.parse(stored);
}
function saveVisits(){
    localStorage.setItem("visit-times",JSON.stringify(visits));
}

/* --- LOG VISIT (FIXED DATE FORMAT) --- */
function logVisit(){
    const now=new Date();
    visits.push({
        timestamp:now.toISOString(),
        date:now.toISOString().split("T")[0] // FIX
    });
    saveVisits();
}

/* --- DATE DEFAULT FIX --- */
function setDefaultDate(){
    const today=new Date().toISOString().split("T")[0];
    document.getElementById("dateFilter").value=today;
    selectedDate=today;
}

/* --- FILTER --- */
function filterByDate(){
    selectedDate=document.getElementById("dateFilter").value || null;
    createVisitChart();
}
function showAllDates(){
    selectedDate=null;
    document.getElementById("dateFilter").value="";
    createVisitChart();
}

/* --- PERIOD FIX (NO event.target) --- */
function changePeriod(days,btn){
    currentPeriod=days;
    document.querySelectorAll(".period-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    createActivityChart();
}

/* --- CHARTS --- */
function createVisitChart(){
    const canvas=document.getElementById("visitChart");
    if(!canvas)return;

    const ctx=canvas.getContext("2d");
    const dataVisits=selectedDate
        ?visits.filter(v=>v.date===selectedDate)
        :visits;

    const hours={};
    dataVisits.forEach(v=>{
        const h=new Date(v.timestamp).getHours();
        hours[h]=(hours[h]||0)+1;
    });

    const labels=Object.keys(hours).sort((a,b)=>a-b);
    const data=labels.map(h=>hours[h]);

    if(visitChart)visitChart.destroy();

    visitChart=new Chart(ctx,{
        type:"line",
        data:{
            labels:labels.map(h=>`${h}:00`),
            datasets:[{
                label:"Visits",
                data,
                borderWidth:3,
                fill:true,
                tension:.4
            }]
        },
        options:{responsive:true,maintainAspectRatio:false}
    });
}

function createActivityChart(){
    const canvas=document.getElementById("activityChart");
    if(!canvas)return;

    const ctx=canvas.getContext("2d");
    const labels=[],data=[];
    const now=new Date();

    for(let i=currentPeriod-1;i>=0;i--){
        const d=new Date(now.getTime()-i*86400000);
        const ds=d.toISOString().split("T")[0];
        labels.push(ds);
        data.push(visits.some(v=>v.date===ds)?1:0);
    }

    if(activityChart)activityChart.destroy();

    activityChart=new Chart(ctx,{
        type:"bar",
        data:{labels,datasets:[{label:"Login Activity",data}]},
        options:{responsive:true,maintainAspectRatio:false}
    });
}

/* --- PAGE SWITCH FIX (IMPORTANT) --- */
function showPage(page){
    document.getElementById("mainPage").classList.remove("active");
    document.getElementById("morePage").classList.remove("active");

    if(page==="main"){
        document.getElementById("mainPage").classList.add("active");
        setTimeout(()=>{
            createVisitChart();
            createActivityChart();
        },50);
    }else{
        document.getElementById("morePage").classList.add("active");
    }
}

/* --- TEST / CLEAR --- */
function addTestData(){
    const now=new Date();
    for(let i=0;i<25;i++){
        const d=new Date(now.getTime()-Math.random()*20*86400000);
        visits.push({
            timestamp:d.toISOString(),
            date:d.toISOString().split("T")[0]
        });
    }
    saveVisits();
    createVisitChart();
    createActivityChart();
}
function clearData(){
    localStorage.removeItem("visit-times");
    visits=[];
    createVisitChart();
    createActivityChart();
}

/* --- INIT --- */
function init(){
    loadVisits();
    logVisit();
    setDefaultDate();
    createVisitChart();
    createActivityChart();
}
init();
</script>

</body>
</html>
